[!v2] stop 'diff format changed in v2'

# FIXME add chezmoi diff --color test (requires care with line endings)

chmod 700 $HOME${/}.ssh

# test that chezmoi diff generates no output when the source and destination states are equal
chezmoi diff
! stdout .

# test that chezmoi diff generates a diff when a file is added to the source state
cp golden/dot_inputrc ${CHEZMOISOURCEDIR}/dot_inputrc
chezmoi diff
cmp stdout golden/add-file-diff
rm ${CHEZMOISOURCEDIR}/dot_inputrc

# test that chezmoi diff generates a diff when a file is edited
edit $HOME/.bashrc
chezmoi diff
cmp stdout golden/modify-file-diff
chezmoi apply

# test that chezmoi diff generates a diff when a file is removed from the destination directory
rm $HOME/.bashrc
chezmoi diff
cmp stdout golden/remove-file-diff
chezmoi apply

# test that chezmoi diff generates a diff when a directory is removed from the destination directory
rm $HOME/.ssh
chezmoi diff
cmp stdout golden/remove-dir-diff
chezmoi apply

# FIXME remove test

[windows] stop 'remaining tests use POSIX file modes'

# test that chezmoi diff generates a diff when a file's permissions are changed
chmod 755 $HOME/.bashrc
chezmoi diff
cmp stdout golden/chmod-file-diff
chezmoi apply

# test that chezmoi diff generates a diff when a dir's permissions are changed
# FIXME show changes to permissions in diff
chmod 755 $HOME/.ssh
chezmoi diff
cmp stdout golden/chmod-dir-diff
chezmoi apply

-- golden/add-file-diff --
diff --git a/.inputrc b/.inputrc
old mode 0
new mode 100644
index e69de29bb2d1d6434b8b29ae775ad8c2e48c5391..3e8778ee8061d7afb917f3d5f1ee17580dc96c99
--- a/.inputrc
+++ b/.inputrc
@@ -0,0 +1 @@
+# contents of .inputrc
-- golden/modify-file-diff --
diff --git a/.bashrc b/.bashrc
index e9a9fc3629d099c17bce71f43c2b5c773ed3ba45..13faef3591002a9d38fe869ca0e205ca472fac73 100644
--- a/.bashrc
+++ b/.bashrc
@@ -1,2 +1 @@
 # contents of .bashrc
-# edited
-- golden/remove-file-diff --
diff --git a/.bashrc b/.bashrc
old mode 0
new mode 100644
index e69de29bb2d1d6434b8b29ae775ad8c2e48c5391..13faef3591002a9d38fe869ca0e205ca472fac73
--- a/.bashrc
+++ b/.bashrc
@@ -0,0 +1 @@
+# contents of .bashrc
-- golden/remove-dir-diff --
diff --git a/.ssh b/.ssh
new file mode 40000
index 0000000000000000000000000000000000000000..0000000000000000000000000000000000000000
--- /dev/null
+++ b/.ssh
diff --git a/.ssh/config b/.ssh/config
old mode 0
new mode 100644
index e69de29bb2d1d6434b8b29ae775ad8c2e48c5391..24222eaee40f73342b927474372b1632a65cef01
--- a/.ssh/config
+++ b/.ssh/config
@@ -0,0 +1 @@
+# contents of .ssh/config
-- golden/chmod-file-diff --
diff --git a/.bashrc b/.bashrc
old mode 100755
new mode 100644
-- golden/chmod-dir-diff --
diff --git a/.ssh b/.ssh
-- golden/dot_inputrc --
# contents of .inputrc
-- home/user/.bashrc --
# contents of .bashrc
-- home/user/.ssh/config --
# contents of .ssh/config
-- home/user/.local/share/chezmoi/dot_bashrc --
# contents of .bashrc
-- home/user/.local/share/chezmoi/private_dot_ssh/config --
# contents of .ssh/config
